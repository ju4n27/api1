<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>*Servidor*</title>
</head>
<body>
    <h2>Mandar texto</h2>
    <label for="texto">Texto a mandar</label><input type="text" name="textoM" id="textoM" value="">
    <button type="submit" onclick="mandarData()">mandar</button>

    <h2>Recibir texto</h2>
    <button type="submit" onclick="recibirData()">recibir</button>
    <label for="texto">Texto recibido</label><input type="text" name="textoR" id="textoR" value="">
    <script>
    async function mandarData(){
        console.log("*A ver si podemos mandar esto:*");
        const textoM= document.getElementById('textoM').value;
        const data= {dato: textoM};
        data.tiempoDeMandado= Date.now(); //su timestamp
        console.log(data);
        const options= {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json' },
            body: JSON.stringify(data),
        };
        try{
            const respuesta= await fetch('/servicio', options);
            const json= await respuesta.json();
            console.log("*Respuesta del servidor*");
            console.log(json);
        }
        catch(err){
            console.log("ERR**: "+err);
        }
    }
    async function recibirData(){
        const respuesta= await fetch('/servicio');
        const json= await respuesta.json();
        console.log("*Recibi esto:*");
        console.log(json);
        let DB= json.data;
        let N= DB.length;
        let texto= DB[N-1].dato;
        let t1= parseInt(DB[N-1].tiempoDeMandado);
        let t2= parseInt(Date.now());
        let duracion = t2-t1;
        document.getElementById('textoR').value= texto;
        console.log("duracion: "+duracion);
    }
    </script>
</body>
</html>